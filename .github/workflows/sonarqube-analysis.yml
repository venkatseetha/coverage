name: Build and Analyze

on:
  workflow_dispatch:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: Build with Maven
      run: mvn clean install

    - name: Run unit tests and generate coverage report
      run: mvn test jacoco:report

    - name: SonarQube Scan
      env:
        SONAR_TOKEN: sqp_c917e435e65aae05304e8a5cddec8cae361fcc0f
      run: mvn sonar:sonar -Dsonar.projectKey=my_project -Dsonar.host.url=http://3.88.181.110:9000 -Dsonar.login=sqp_c917e435e65aae05304e8a5cddec8cae361fcc0f
